---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getCollection, getEntryBySlug } from 'astro:content';

export const prerender = true; // סטטי, מתאים ל-GitHub Pages

// לבנות את כל דפי הדמויות מ-src/content/characters
export async function getStaticPaths() {
  const entries = await getCollection('characters');
  return entries.map(({ slug }) => ({ params: { slug } }));
}

const { slug } = Astro.params;
if (!slug) throw new Error('Missing slug');

const entry = await getEntryBySlug('characters', slug);
if (!entry) throw new Error(`Character not found: ${slug}`);

const { Content, data } = await entry.render();
const pageTitle = `${data?.name ?? entry.slug} | Compass World`;
const pageDesc  = data?.summary ?? `Profile page for ${data?.name ?? entry.slug}.`;
---

<BaseLayout title={pageTitle} description={pageDesc}>
  <section class="container py-4" data-reveal>
    <a href="/characters/" class="text-white-50">← Back</a>

    <div class="row mt-3 g-4">
      <div class="col-lg-4">
        {data?.image && <img src={data.image} alt={data.name} class="img-fluid rounded-3 shadow-sm will-animate" />}
        {Array.isArray(data?.tags) && data.tags.length > 0 && (
          <div class="mt-3 d-flex flex-wrap gap-2">
            {data.tags.map((t) => <span class="badge bg-secondary">{t}</span>)}
          </div>
        )}
      </div>

      <div class="col-lg-8">
        <h1 class="h3">{data?.name ?? entry.slug}</h1>
        {data?.team && <p class="text-white-50 mb-1">Team: {data.team}</p>}
        {data?.role && <p class="text-white-50 mb-3">Role: {data.role}</p>}
        <article class="prose text-white-80">
          <Content />
        </article>
      </div>
    </div>
  </section>
</BaseLayout>
