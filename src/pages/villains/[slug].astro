---
import BaseLayout from "../../layouts/BaseLayout.astro";
import { getEntryBySlug, getCollection } from "astro:content";

export const prerender = true;

// בונים את רשימת הנתיבים הסטטיים (מונע 404 בזמן build)
export async function getStaticPaths() {
  const villains = await getCollection("villains"); // שם הקולקציה בקונפיג
  return villains.map(({ slug }) => ({ params: { slug } }));
}

const { slug } = Astro.params;

// שולפים את הרשומה בבטחה
const entry = await getEntryBySlug("villains", slug);

// אם לא נמצאה רשומה — הפניה ל־404 (או החזר טקסט מותאם)
if (!entry) {
  return Astro.redirect("/404");
}

// הגנות + ברירות מחדל
const data = entry.data ?? {};
const pageTitle = data.title ?? slug?.replace(/-/g, " ") ?? "Unknown Villain";
const description = data.description ?? "";
const image = data.image ?? "/legacy/gallery/compass-alliance-artwork.webp";
---

<BaseLayout
  title={`Compass World | ${pageTitle}`}
  description={description}
  image={image}
>
  <article class="container">
    <header class="my-4">
      <h1 class="display-5">{pageTitle}</h1>
      {description && <p class="lead">{description}</p>}
    </header>

    {image && (
      <img
        src={image}
        alt={pageTitle}
        class="img-fluid rounded mb-4"
        loading="eager"
      />
    )}

    <!-- גוף התוכן מה-MD/MDX -->
    <Fragment set:html={entry.body} />
  </article>
</BaseLayout>
