---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

const list = await getCollection('history');

// ממיר "750BC", "200 CE", "c. 150 bc", "700–600 BC" וכו' למספר; BC שלילי
function yearKey(y: unknown) {
  if (typeof y === 'number') return y;
  const s = String(y ?? '').trim().toLowerCase();
  if (!s) return Number.POSITIVE_INFINITY;

  // האם BC/BCE?
  const isBC = /\b(?:bc|bce)\b/.test(s);

  // קח את המספר הראשון (בתווך/טווח ניקח את ההתחלה)
  const m = s.match(/-?\d{1,4}/);
  if (!m) return Number.POSITIVE_INFINITY;

  const n = parseInt(m[0], 10);
  return isBC ? -n : n;
}

const sorted = [...list].sort((a, b) => {
  const ka = yearKey(a.data.year);
  const kb = yearKey(b.data.year);
  if (ka !== kb) return ka - kb;        // קטן יותר קודם (BC קודם)
  return a.slug.localeCompare(b.slug);  // שובר שוויון יציב
});
---
<BaseLayout title="Chronology | Compass World">
  <section class="container py-4">
    <h1 class="h3 mb-4">Chronology</h1>
    <div class="row g-4">
      {sorted.map((h) => (
        <div class="col-12 col-md-6 col-lg-4">
          <a class="card p-3 h-100 d-block will-animate" href={`/history/${h.slug}/`}>
            <h2 class="h5 text-white mb-1">{h.data.year}</h2>
            {h.data.image && <img src={h.data.image} alt={h.data.year} class="img-cover mt-2" loading="lazy" />}
            <p class="text-white-50 mt-2 mb-0">{h.data.description}</p>
          </a>
        </div>
      ))}
    </div>
  </section>
</BaseLayout>
